# CouchDB for Zone1 (Quick Guide)

This document explains how Zone1 can verify and use CouchDB in the Zone2 POC.

Prerequisite: Zone2 services must be running (`docker compose up` from Zone2 compose file).

## What CouchDB is used for here

- In Fabric, CouchDB stores the **world state** (current data state).
- The immutable history stays in the Fabric blockchain (blocks), not in CouchDB.
- Zone1 should not write directly to CouchDB in production; writes must go through chaincode.

## Important: no "tables"

- CouchDB does not use SQL tables.
- It uses **databases** and **JSON documents**.
- At startup, it is normal to only see system databases.
- Application-level Fabric databases appear after:
  1) peers join the channel,
  2) chaincode is deployed,
  3) first transactions are submitted.
- Fabric database names are generated by Fabric; Zone1 should not create them manually.

## POC CouchDB endpoints

- OrgJ2: `http://localhost:5984`
- OrgEM: `http://localhost:6984`
- User: `admin`
- Password: `adminpw`

## Quick checks

Check service health first:

```bash
curl -u admin:adminpw http://localhost:5984/_up
curl -u admin:adminpw http://localhost:6984/_up
```

Expected result: `{"status":"ok"}`.

List databases:

```bash
curl -u admin:adminpw http://localhost:5984/_all_dbs
curl -u admin:adminpw http://localhost:6984/_all_dbs
```

Read one document (example):

```bash
curl -u admin:adminpw "http://localhost:5984/<database_name>/<doc_id>"
```

Query with Mango:

```bash
curl -u admin:adminpw -H "Content-Type: application/json" \
  -X POST "http://localhost:5984/<database_name>/_find" \
  -d '{"selector":{"type":"decision"}}'
```

## SQL "create table" equivalent

SQL -> CouchDB mapping:

- Table -> Database + document type
- Row -> JSON document
- Index -> JSON index (`_index`)

Example document:

```json
{
  "_id": "decision:123",
  "type": "decision",
  "hash": "abc123...",
  "status": "validated",
  "timestamp": "2026-02-06T12:00:00Z"
}
```

## Governance rule

- For both POC and target production design, Zone1 should use Fabric SDK / chaincode API.
- CouchDB is for state inspection and debugging, not as a direct business write entry point.
